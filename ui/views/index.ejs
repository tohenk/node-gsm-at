<div class="ui top attached tabular menu">
  <a class="active item" data-tab="activity">Activity</a>
  <a class="item" data-tab="log">Logs</a>
  <% term.getTerminals(true).forEach((port) => { -%>
  <a class="item" data-tab="<%= port %>"><%= port %></a>
  <% }); %>
</div>
<div class="ui bottom attached active tab segment" data-tab="activity">
  <%- include('activity') %>
</div>
<div class="ui bottom attached tab segment" data-tab="log">
  <%- include('log') %>
</div>
<%- include('termhandler') %>
<% term.getTerminals(true).forEach((port) => { -%>
<div class="ui bottom attached tab segment" data-tab="<%= port %>">
  <%- include('term', {port: port}) %>
</div>
<% }); %>
<%- include('menu') %>
<% script.create('jQuery')
  .useDependencies(['SocketIO'])
  .add(`
// socket handler
$.uiCon = {
    connected: false,
    keepalive: true,
    url: '${sockaddress}',
    init: function() {
        var self = this;
        self.socket = io.connect(self.url, { reconnect: self.keepalive });
        self.socket.on('connect', function() {
            self.connected = true;
            console.log('Socket connected');
        });
        self.socket.on('disconnect', function() {
            self.connected = false;
            console.log('Socket disconnected');
        });
        self.socket.on('log', function(data) {
            $.term.addLog(data.term, data);
        });
        self.socket.on('activity', function(data) {
            $.log.add(data);
        });
        self.socket.on('new-activity', function(type) {
            $.activity.load();
        });
        self.socket.on('new-terminal', function() {
            window.location.reload();
        });
    }
}
// initialize
$('.menu .item').tab();
$.activity.load();
$.log.load();
$.tasks.init();
$.uiCon.init();
`); %>
